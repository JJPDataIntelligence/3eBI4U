<!--RGB(18,43,65) - RGB(255,163,26)-->

{% extends 'base.html' %}
{% load widget_tweaks %}
{% load i18n %}
{% load static %}
{% load thumbnail %}
{% load django_tables2 %}

{% block head %}
    <title>BI4U - Funcionário</title>
{% endblock head %}

{% block custom_scripts %}

<script>

    $(document).ready(function(){


        // Enabling and Disabling Submit Button on ShutDown Form
        const selectElement = document.querySelector('#CPFConfirmation');

        selectElement.addEventListener('change', (event) => {
        var ofCPF = $('#officialCPF').text();
        var CPF = $('#CPFConfirmation').val();
        var id = document.getElementById("eid").textContent;

            if (ofCPF === CPF) {
                $('#submitShutDown').prop("disabled", false);
                $('#shutDownID').val(id); 
            } else {
                $('#submitShutDown').prop("disabled", true);
                $('#shutDownID').val('');
            }
        });

        // Adding Popover Event to Picture
        $('[data-toggle="popover"]').popover(); 

        if (window.location.hash === "#load") {
            if (document.getElementById("eid").innerText !== "") {
                $("#employee_preview").css("display", "block")
            }
        }
    })

    // Creating Visualize Employee URL and Assigning Window Location
    function visualizeEmployee() {
        var id = document.getElementById("eid").textContent

        if (id !== '') {
            window.location.assign("/funcionario/visualizar/" + id);
        } else if (id == ''){
            document.getElementById("alert2").style.display = "block";
        }
    }

    function occurrenceShutDownRB() {
        var OSDRB = document.getElementById('opt3');
        var OSDTA = document.getElementById('occurrenceShutDown');

        if (OSDRB.checked) {
            OSDTA.style.display = "block";
        } else {
            OSDTA.style.display = "none";
        }
    }




</script>

{% endblock custom_scripts %}

{% block linked_refs %}     

    <link rel="stylesheet" href='{% static "css/funcionarios_appmenu.css" %}'>

{% endblock linked_refs %}


{% block content %}

    {% if ERROR == 1 %}
        <div id="alert" class="alert alert-warning alert-dismissible fade in">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Funcionário Não Encontrado!</strong> A busca pelo CPF do funcionário não retornou nenhum resultado.
        </div>
    {% endif %}

    {% if ERROR == 3 %}
        <div id="alert" class="alert alert-danger alert-dismissible fade in">
            <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
            <strong>Funcionário Já Desligado!</strong> O Funcionário que você tentou desligar já estava desativado.
        </div>
    {% endif %}



    <div id="alert2" class="alert alert-danger alert-dismissible fade in" style="display: none;">
        <a class="close" onclick="$('#alert2').hide()">&times;</a>
        <strong>Nenhum Funcionario Pesquisado!</strong> Favor Preencher o Campo Buscar Funcionário com um CPF válido.
    </div>



    <div class="spacer"></div>

    <div class="container" style="transform: translateX(-5%);">

        <div class="col-lg-6">
            <div class="row">

                <label for="Funcionario">Buscar Funcionário:</label>
                <form method="GET" action="/funcionario#load">
                    <div class="input-group">
                        <input name="CPF" id="Funcionario" type="text" class="form-control cpf" placeholder="Insira o CPF do Funcionário">
                        <div class="input-group-btn">
                            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form> 

            </div>
                
            <div class="spacer-xl"></div>

            <div class="row" style="display:none;" id="employee_preview">
                 <!--
                <h3 style="transform: translateY(-100%);"><small class="text-info">Para mais informações clique em "Visualizar Funcionário"</small></h3>
                -->   
                <div class="col-lg-8" style="font-weight: bold; padding: 10px;">

                    {% if object.obs_desligamento %}
                        <span class="text-danger" >Funcionário Previamente Desligado com Ocorrência !</span>
                        <div class="spacer"></div>
                    {% endif %}
                    
                    <span style="float: left;">Nome:</span><span style="float: right;">{{object.primeiro_nome}} {{object.ultimo_nome}}</span>
                    </br>
                    <span style="float: left;">CPF:</span><span id = "officialCPF" style="float: right;">{{object.numero_documento_CPF}}</span>
                    </br>
                    <span>Status:</span><span style="float: right;">
                        {% if not object.ativo %}
                            Funcionário Desligado
                        {% else %}
                            {% if objeto.ferias %}
                                Funcionário em Férias
                            {% else %}
                                Funcionário Ativo
                            {% endif %}
                        {% endif %}
                    </span>
                    </br>
                    <span>ID:</span><span id="eid" style="float: right;">{{object.id}}</span>
                    <br>
                    {% if object.obs_desligamento %}
                        <span>Observações da Ocorrencia:</span><br><br><span>{{object.obs_desligamento}}</span>
                    {% endif %}
                    
                </div>
                <div class="col-lg-1"></div>
                
                {% if not object.ativo  %}
                    {% thumbnail imageObject.docscan_picture "250x250" colorspace="GRAY" as im %}
                    <img data-placement="bottom" data-toggle="popover" data-trigger="hover" data-content="Clique aqui para maiores informações sobre o funcionário." class="col-lg-3" src="{{ im.url }}" style='border-radius:50px; padding:1px; transform: translateY(-15%); cursor: pointer;' onclick="visualizeEmployee()">
                    {% empty %}
                        <p>Sem Imagem</p>
                    {% endthumbnail %}    
                {% else %}
                    {% thumbnail imageObject.docscan_picture "250x250" as im %}
                    <img data-placement="bottom" data-toggle="popover" data-trigger="hover" data-content="Clique aqui para maiores informações sobre o funcionário." class="col-lg-3" src="{{ im.url }}" style='border-radius:50px; padding:1px; transform: translateY(-15%); cursor: pointer;' onclick="visualizeEmployee()">
                    {% empty %}
                        <p>Sem Imagem</p>
                    {% endthumbnail %}    
                {% endif %}
                    
            </div>

        </div>

        <div class="col-lg-1" ></div>

        <div class="col-lg-5" style="transform: translateX(20%);">

            <div class="row">

                <a href="/funcionario/cadastro">
                <button class="col-lg-3 btn btnleft" style="color:white;">
                    <span>Cadastrar Novo Funcionário</span>
                </button>
                </a>

                <button class="col-lg-3 btn btnright" data-toggle="modal" href="#modalTable" style="color:white;">
                    <span>Visualizar Funcionários</span>
                </button>        
            </div>
            
            <div class="spacer-xl"></div>

            <div class="row">
    
                <button class="col-lg-3 btn btnleft" data-toggle="modal" href="#modalShutDown" style="color:white;">
                    <span>Desligar Funcionário</span>
                </button>
    
                <button class="col-lg-3 btn btnright" style="color:white;">
                    <span>Outros</span>
                </button>
            
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalTable">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Funcionarios Cadastrados</h4>
                </div>
                <div class="modal-body">
                    {% render_table table 'django_tables2/bootstrap-responsive.html' %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>


    <div class="modal fade" id="modalShutDown">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Desligamento de Funcionário - {{ object.primeiro_nome }} {{ object.ultimo_nome }}</h4>
                </div>
                <div class="modal-body">

                    <form method="POST" action="/funcionario/">
                        {% csrf_token %}
                        <div class="form-group">
                            
                            <br>

                            <label class="radio-inline"><input type="radio" name="optradio" id="opt1" onclick="occurrenceShutDownRB()" checked>Demissão</label>
                            <label class="radio-inline"><input type="radio" name="optradio" id="opt2" onclick="occurrenceShutDownRB()">Demissão Voluntária</label>
                            <label class="radio-inline"><input type="radio" name="optradio" id="opt3" onclick="occurrenceShutDownRB()">Demissão com Ocorrência</label>
                            
                            <div class="spacer"></div>

                            <div class="form-group" id="occurrenceShutDown" style="display:none;">
                                <label for="occurrenceShutDown">Registro de Ocorrência:</label>
                                <textarea class="form-control" name="occurrenceShutDown"  rows="5" style="resize: none;"></textarea>
                            </div>

                            <div class="spacer"></div>

                            <label for="CPFConfirmation" class = "control-label">Para Confirmar o <u>Desligamento</u> do Funcionário, Digite o CPF</label>
                            <input name = "CPFConfirmation" type="text" class = "form-control cpf" id = "CPFConfirmation" placeholder="000.000.000-00">
                            <input name = "shutDownID" type="hidden" id = "shutDownID" value="">

                            <br>

                            <input id="submitShutDown" class="btn btn-sm btn-primary" type="submit" style="float:right;" value="Desligar Funcionário" disabled>
                            
                            <div class="spacer"></div>

                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
    

{% endblock content %}